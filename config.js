const path = require('path');

const TARGET_DIR = process.cwd();
const PROJECT_DIR = __dirname;

const defaultStoriesConfig = {
  branding: {
    name: 'Storybook',
    icon: {
      type: 'image/x-icon',
      url: 'data:image/vnd.microsoft.icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAANcNAADXDQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADkreCQ2KHTQORxxCQAAAAA2KnU9NCd2JwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA1KHWBNih1/zcndmE1J3VINih18DcoczMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANil13Dcndag2KHXgNih18TYpdEsAAAAANSh10jMzZgU2KHWSAAAAATYpdZYAAAABNil1lgAAAAA2KHWSOCp0NzYodelAK4AMNih14zYodd42KHVZKyuABgAAgAIAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAATYodZI2KHWSAAAAAEArgAw2J3SiNih1/zUodc03J3SVAACAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAgAQ2KHXpNSd0XDUodYE2KHXdNih25jUodYs3K3MqAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA1KXRENih1/zYodfQ3KXWjNyh1RlUAVQMAAAAAAAAAADYodZIAAIACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANSt1GDUpdVdAK4AMAAAAATYodZIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANyd0lQAAgAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABNil1lgAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAA3J3SVAACAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE2KXWWAAAAAAAAAAAAAAAAAACAAgAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAACAAgAAAAAAAAAAAAAAADYodcszM2YFNih1jgAAAAE2KHWSAAAAATYodZIAAAAANSd2jwAAAAA2KHWSAACAAjcpdckAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP/EAAD/wAAA/8EAAAEAAABVEAAAPwAAAP8DAAA/BwAA//8AAD/nAAB/9wAAP+cAAFVXAAABRwAA//8AAA==',
    },
    logo: false,
  },
  storybookDir: '.storybook',
  webpackConfig: 'webpack.config.js',
  storiesMask: '**/*.story.js',
  ignore: 'node_modules/**/*',
  setupFile: 'additional.js',
  previewHeader: 'preview-header.html',
  middlewaresFile: 'middlewares.js',
};

const customStoriesConfig = require(path.resolve(TARGET_DIR, 'package.json'))['storybook'] || {};

Object.keys(customStoriesConfig).forEach((key) => {
  !!defaultStoriesConfig[key] && console.log(
    `using custom setting ${key}: ${customStoriesConfig[key]}`
  );
});

const storiesConfig = Object.assign({}, defaultStoriesConfig, customStoriesConfig);

const STORYBOOK_DIR = path.resolve(TARGET_DIR, storiesConfig.storybookDir);

module.exports = {
  stories: storiesConfig,
  paths: {
    TARGET_DIR: TARGET_DIR,
    PROJECT_DIR: PROJECT_DIR,
    STORYBOOK_DIR: STORYBOOK_DIR,

    TARGET_NODE_MODULES: path.resolve(TARGET_DIR, 'node_modules'),
    PROJECT_NODE_MODULES: path.resolve(PROJECT_DIR, 'node_modules'),

    CUSTOM_WEBPACK_CONFIG: path.resolve(TARGET_DIR, storiesConfig.storybookDir, storiesConfig.webpackConfig),
    DEFAULT_WEBPACK_CONFIG: path.resolve(PROJECT_DIR, 'defaults/webpack.config.js'),

    CUSTOM_PREVIEW_HEADER: path.resolve(TARGET_DIR, storiesConfig.storybookDir, storiesConfig.previewHeader),

    SETUP_FILE: path.resolve(TARGET_DIR, storiesConfig.storybookDir, storiesConfig.setupFile),
    MIDDLEWARES_FILE: path.resolve(TARGET_DIR, storiesConfig.storybookDir, storiesConfig.middlewaresFile),

    MANAGER_APP: path.resolve(PROJECT_DIR, 'js/manager.js'),
    PREVIEW_APP: path.resolve(PROJECT_DIR, 'js/preview.js'),
  }
}
